<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ë°›ì€ í¸ì§€</title>
  <link rel="stylesheet" href="/static/letters.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">


</head>
<body>
  <div class="container">
    <div class="content">
        <div class="header-actions">
        <div class="home-button">
            <a href="/" title="í™ˆìœ¼ë¡œ">
            <i class="fa-solid fa-house"></i> í™ˆ
            </a>
        </div>
        <div class="logout">
            <a href="{{ url_for('logout') }}">
            <i class="fa-solid fa-right-from-bracket"></i> ë¡œê·¸ì•„ì›ƒ
            </a>
        </div>
        </div>
        

        <h1 class="title"><span class="highlight" id="teacher-name"></span> ì„ ìƒë‹˜</h1>
        <p id="teacher-bio" class="teacher-bio"></p>
        <a id="back" href="/teachers" class="button" style="display: none;">ëª©ë¡ìœ¼ë¡œ</a>
        <a id="write-link" class="button" style="display: none;">í¸ì§€ì“°ê¸°</a>
        <ul id="letter-list"></ul>
    </div>
  </div>
  <script>
    const teacherId = {{ teacher_id }};
    const role = "{{ role }}";
    const userId = {{ user_id }};
    document.getElementById('write-link').href = `/write/${teacherId}`;

    if (role === 'student') {
      document.getElementById('back').style.display = 'inline-block';
      document.getElementById('write-link').style.display = 'inline-block';
    }
    
    (async () => {
      const [tRes, lRes] = await Promise.all([
        fetch('/api/teachers'),
        fetch(`/api/letters/${teacherId}`)
      ]);

      if (!tRes.ok || !lRes.ok) {
        alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤');
        return;
      }

      const teachers = await tRes.json();
      const letters = await lRes.json();
      const teacher = teachers.find(t => t.teacher_id === teacherId);

      document.getElementById('teacher-name').textContent = teacher.name;
      document.getElementById('teacher-bio').textContent = teacher.bio;

      const ul = document.getElementById('letter-list');
      const currentTime = new Date();
      const revealTime = new Date('2025-05-09T18:00:00');
      
      letters.forEach(l => {
        const li = document.createElement('li');
        if ((userId === teacherId || userId === l.sender_id) && currentTime > revealTime) {
          li.innerHTML = `ğŸ§‘ğŸ»â€ğŸ“ <span class="letter-title">${l.title}</span>
          <br><br>ğŸŒº ${l.content}</span>
          <br><br><span class="letter-date">${l.created_at}</span>`;
        } else {
          li.innerHTML = `ğŸ§‘ğŸ»â€ğŸ“ <span class="letter-title">${l.title}</span>
          <br><br>ğŸŒº <span class="mosaic">${l.content}</span>
          <br><br><span class="letter-date">${l.created_at}</span>`;
        }
        ul.appendChild(li);
      });
    })();
  </script>
</body>
</html>
